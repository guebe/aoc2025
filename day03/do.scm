(define example '((9 8 7 6 5 4 3 2 1 1 1 1 1 1 1) (8 1 1 1 1 1 1 1 1 1 1 1 1 1 9) (2 3 4 2 3 4 2 3 4 2 3 4 2 7 8) (8 1 8 1 8 1 9 1 1 1 1 2 1 1 1)))
(load "input.scm")
(load "../srfi-1.scm")
(load "../test.scm")

(define (digits->number digits)
  (fold (lambda (d acc) (+ (* acc 10) d)) 0 digits))

(define (max-joltage digits k)
  (define (recur digits k)
    (if (= k 0)
        '()
	(let* ((window (take digits (- (length digits) k -1)))
	       (best (apply max window))
	       (rest (cdr (memv best digits))))
	  (cons best (recur rest (- k 1))))))
  (digits->number (recur digits k)))

(define (sum-joltage in k)
  (fold (lambda (n acc) (+ acc (max-joltage n k))) 0 in))

(test (sum-joltage example 2) 357)
(test (sum-joltage input 2) 17196)
(test (sum-joltage example 12) 3121910778619)
(test (sum-joltage input 12) 171039099596062)
